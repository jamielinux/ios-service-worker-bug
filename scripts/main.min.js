!function(){"use strict";var e,n,t;e=function(){var e,n,t,o=!1,i=window.AudioContext||window.webkitAudioContext,s=this;void 0!==i?i=new i:(o=!0,e=document.createElement("audio"));var a=function(n){if(n=n||function(){},o)e.src="sounds/airhorn.mp3";else if(i.resume(),1!=!!t){var s=new XMLHttpRequest;s.onload=function(){i.decodeAudioData(s.response,function(e){n(e)})},s.open("GET","sounds/airhorn.mp3"),s.responseType="arraybuffer",s.send()}else n(t)};this.start=function(t){var r=t.loop;if(o)return e.loop=r,e.currentTime=0,void e.play();a(function(e){(n=i.createBufferSource()).connect(i.destination),n.buffer=e,n.onended=function(){s.stop()},n.start(0),n.loop=r,n.loopStart=.24,n.loopEnd=.34})},this.stop=function(){!0==!!n&&(n.loop=!1),o&&(e.loop=!1,e.pause()),this.onstopped()},this.onstopped=function(){},a(function(e){t=e})},n=function(e){var n,t=function(t){n&&(n.prompt(),n.userChoice.then(function(t){n=null,e.classList.remove("available")}).catch(function(t){n=null,e.classList.remove("available")}))};window.addEventListener("beforeinstallprompt",function(t){return(n=t).preventDefault(),e.classList.add("available"),!1}),window.addEventListener("appinstalled",function(t){n=null,e.classList.remove("available")}),e.addEventListener("click",t.bind(this)),e.addEventListener("touchend",t.bind(this))},t=function(n){var t=n.querySelector(".horn"),o=new e;"clearAppBadge"in navigator&&navigator.clearAppBadge();var i=0,s=function(e){if(1==!!e&&(0==r&&e.preventDefault(),e.touches&&e.touches.length>1))return!1;this.start({loop:!0})},a=function(e){1==!!e&&e.preventDefault(),this.stop()};this.start=function(e){t.classList.add("horning"),t.setAttribute("aria-pressed","true"),o.start(e),"setAppBadge"in navigator&&(99===i&&(i=0),navigator.setAppBadge(++i)),o.onstopped=function(){t.classList.remove("horning"),t.setAttribute("aria-pressed","false")}},this.stop=function(){t.classList.remove("horning"),o.stop()};var r=!1;try{var d=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("testPassive",null,d),window.removeEventListener("testPassive",null,d)}catch(e){}t.addEventListener("mousedown",s.bind(this),!!r&&{passive:!0}),t.addEventListener("touchstart",s.bind(this),!!r&&{passive:!0});var c=!1;t.addEventListener("keydown",function(e){0==c&&["Space","Enter","SoftCenter","Digit5"].includes(e.code)&&(e.preventDefault(),s.call(this),c=!0)}.bind(this),!1),document.documentElement.addEventListener("mouseup",a.bind(this)),document.documentElement.addEventListener("touchend",a.bind(this)),document.documentElement.addEventListener("keyup",function(){1==c&&(a.call(this),c=!1)}.bind(this))},window.addEventListener("load",function(){var e=document.getElementById("airhorn"),o=document.getElementById("installer"),i=new t(e);if(new n(o),Comlink&&window.opener){var s=new MessageChannel,a=s.port1;Comlink.expose(i,a),opener.postMessage({cmd:"READY"},"*",[s.port2])}navigator.presentation&&navigator.presentation.receiver&&navigator.presentation.receiver.connectionList.then(function(e){e.connections.forEach(function(e){Comlink.expose(i,MessageChannelAdapter.wrap(e))}),e.onconnectionavailable=function(e){Comlink.expose(i,MessageChannelAdapter.wrap(e.connection))}}),"#instant"==location.hash&&i.start({loop:!1}),window.addEventListener("hashchange",function(){"#instant"==location.hash&&i.start({loop:!1})}),document.addEventListener("visibilitychange",function(){document.hidden&&i.stop()})})}();
